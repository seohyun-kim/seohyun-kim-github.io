---
layout: single
title:  "CCTV_ver_4.1. ë°ì´í„° ë¶„ì„ ì‹œìŠ¤í…œ"
author: seohyun-kim
date: 2021-08-05 18:00
comments: true
---


[![image](https://user-images.githubusercontent.com/61939286/125255176-2006fc80-e336-11eb-8f49-04f48e600742.png)](https://github.com/seohyun-kim/CCTV-Monitoring-System.git)  
â¡ ìœ„ ì´ë¯¸ì§€ë¥¼ í´ë¦­í•˜ë©´ Repositoryë¡œ ì´ë™í•©ë‹ˆë‹¤.  

<br>  

## ê³¼ì œ ëª©í‘œ  

> [ë¦¬ëˆ…ìŠ¤ ì„œë²„ í™˜ê²½ êµ¬ì¶•](https://seohyun-kim.github.io/CCTV.ver.4.1/#1-%EB%A6%AC%EB%88%85%EC%8A%A4-%EC%84%9C%EB%B2%84%EC%97%90-mysql%EC%84%A4%EC%B9%98-%EB%B0%8F-%EC%99%B8%EB%B6%80-%EC%A0%91%EC%86%8D%ED%97%88%EC%9A%A9)   
> [ë°ì´í„° ë² ì´ìŠ¤ ë¶„ì„ ì‹œìŠ¤í…œ(ë¶„ì„ tableìƒì„±, ì´ë²¤íŠ¸ ìƒì„±, ì´ìƒê°’ íƒì§€)](https://seohyun-kim.github.io/CCTV.ver.4.1/#2-%EB%8D%B0%EC%9D%B4%ED%84%B0-%EB%B2%A0%EC%9D%B4%EC%8A%A4-%EB%B6%84%EC%84%9D-%EC%8B%9C%EC%8A%A4%ED%85%9C)  
> [ì˜ìƒíŒ€ì—ì„œ í˜¸ì¶œí•  ìˆ˜ ìˆëŠ” API ìƒì„±(ì¸ì¦ì ˆì°¨ ì¶”í›„ ì ìš© ì˜ˆì •)](https://seohyun-kim.github.io/CCTV.ver.4.1/#3-%EC%98%81%EC%83%81%ED%8C%80%EC%97%90%EC%84%9C-%ED%98%B8%EC%B6%9C%ED%95%A0-%EC%88%98-%EC%9E%88%EB%8A%94-api-%EC%83%9D%EC%84%B1)



<br>  

# 1. ë¦¬ëˆ…ìŠ¤ ì„œë²„ í™˜ê²½ êµ¬ì¶•

### ë¦¬ëˆ…ìŠ¤ ì„œë²„ì— mysqlì„¤ì¹˜ ë° ì ‘ì†ì„¤ì •

> mysql ì„¤ì¹˜ ì™„ë£Œ , DBìƒì„±  
> ì‚¬ìš©ì ê³„ì • ìƒì„± ë° DBê¶Œí•œ ë¶€ì—¬  
> ì™¸ë¶€ ì ‘ì† í—ˆìš©
> 3306 í¬íŠ¸ allow
 
```sql
mysql> show databases;
+--------------------+
| Database           |
+--------------------+
| cctv               |
| information_schema |
+--------------------+
2 rows in set (0.01 sec)

mysql> show grants;
+-------------------------------------------------+
| Grants for malab@%                              |
+-------------------------------------------------+
| GRANT USAGE ON *.* TO `malab`@`%`               |
| GRANT ALL PRIVILEGES ON `cctv`.* TO `malab`@`%` |
+-------------------------------------------------+
2 rows in set (0.01 sec)
```

### Node.js ì„¤ì¹˜

> PPA ë¡œ node.jsì™€ npmì„¤ì¹˜  
```
$ node -v
v14.17.4
$ npm -v
6.14.14
```

### MySQL table ìƒì„±    
> ì™¸ë˜í‚¤ë¥¼ ì„¤ì •í•˜ì—¬ ridë¡œ ì°¸ì¡°ë  ìˆ˜ ìˆë„ë¡ í•¨


```sql
mysql> show tables;
+------------------------+
| Tables_in_cctv         |
+------------------------+
| bicycle_pos            |
| bicycle_speed          |
| bus_pos                |
| bus_speed              |
| car_pos                |
| car_speed              |
| cctv_bbox              | 
| cctv_data              | < --- ê¸°ë³¸ ì „ì²´ ë°ì´í„° (1ë¶„ë‹¹ 1 row)
| electric_scooter_pos   |
| electric_scooter_speed |
| motocycle_pos          |
| motocycle_speed        |
| person_pos             |
| person_speed           |
| truck_pos              |
| truck_speed            |
+------------------------+
16 rows in set (0.00 sec)

mysql> desc cctv_data;
+--------------------+-----------+------+-----+---------+----------------+
| Field              | Type      | Null | Key | Default | Extra          |
+--------------------+-----------+------+-----+---------+----------------+
| rid                | int       | NO   | PRI | NULL    | auto_increment |
| date_time          | timestamp | YES  |     | NULL    |                |
| n_person           | int       | YES  |     | NULL    |                |
| n_car              | int       | YES  |     | NULL    |                |
| n_truck            | int       | YES  |     | NULL    |                |
| n_bus              | int       | YES  |     | NULL    |                |
| n_bicycle          | int       | YES  |     | NULL    |                |
| n_motorcycle       | int       | YES  |     | NULL    |                |
| n_electric_scooter | int       | YES  |     | NULL    |                |
+--------------------+-----------+------+-----+---------+----------------+
9 rows in set (0.00 sec)

mysql> desc person_pos;
+-----------+-----------+------+-----+---------+-------+
| Field     | Type      | Null | Key | Default | Extra |
+-----------+-----------+------+-----+---------+-------+
| rid       | int       | NO   | PRI | NULL    |       |
| date_time | timestamp | YES  |     | NULL    |       |
| loc_0     | int       | YES  |     | NULL    |       |
| loc_1     | int       | YES  |     | NULL    |       |
| loc_2     | int       | YES  |     | NULL    |       |
| loc_3     | int       | YES  |     | NULL    |       |
| loc_4     | int       | YES  |     | NULL    |       |
| loc_5     | int       | YES  |     | NULL    |       |
| loc_6     | int       | YES  |     | NULL    |       |
| loc_7     | int       | YES  |     | NULL    |       |
| loc_8     | int       | YES  |     | NULL    |       |
+-----------+-----------+------+-----+---------+-------+
11 rows in set (0.01 sec)

mysql> desc person_speed;
+-----------+-----------+------+-----+---------+-------+
| Field     | Type      | Null | Key | Default | Extra |
+-----------+-----------+------+-----+---------+-------+
| rid       | int       | NO   | PRI | NULL    |       |
| date_time | timestamp | YES  |     | NULL    |       |
| loc_0     | float     | YES  |     | NULL    |       |
| loc_1     | float     | YES  |     | NULL    |       |
| loc_2     | float     | YES  |     | NULL    |       |
| loc_3     | float     | YES  |     | NULL    |       |
| loc_4     | float     | YES  |     | NULL    |       |
| loc_5     | float     | YES  |     | NULL    |       |
| loc_6     | float     | YES  |     | NULL    |       |
| loc_7     | float     | YES  |     | NULL    |       |
| loc_8     | float     | YES  |     | NULL    |       |
+-----------+-----------+------+-----+---------+-------+
11 rows in set (0.00 sec)
```
<details>
    <summary> Table ìƒì„± ì½”ë“œ </summary>  
  
 <div markdown="1">  
   
   ```sql
   create table cctv_data(
	  rid int NOT NULL AUTO_INCREMENT PRIMARY KEY,
      date_time TIMESTAMP ,
      n_person int ,
      n_car int,
      n_truck int,
      n_bus int,
      n_bicycle int,
      n_motorcycle int,
      n_electric_scooter int
  );    
   
   create table person_pos(
	  rid int NOT NULL PRIMARY KEY,
      date_time TIMESTAMP ,
	  loc_0 int,
      loc_1 int,
      loc_2 int,
      loc_3 int,
      loc_4 int,
      loc_5 int,
      loc_6 int,
      loc_7 int,
      loc_8 int,
      foreign key (rid) references cctv_data (rid)
  );  
   
     create table person_speed(
	  rid int NOT NULL primary key,
      date_time TIMESTAMP ,
	  loc_0  float,
      loc_1  float,
      loc_2  float,
      loc_3  float,
      loc_4  float,
      loc_5  float,
      loc_6  float,
      loc_7  float,
      loc_8  float,
      foreign key (rid) references cctv_data (rid)
  );  
   
   ```
   
</div>  
  
</details>   

<br>  

### íƒ€ì„ì¡´ ì„¤ì • ë° í™•ì¸  

> ìš°ë¶„íˆ¬ ì„œë²„  


``` cmd
  ~$ timedatectl
                 Local time: í†  2021-08-14 01:02:22 KST
             Universal time: ê¸ˆ 2021-08-13 16:02:22 UTC
                   RTC time: ê¸ˆ 2021-08-13 16:02:22
                  Time zone: Asia/Seoul (KST, +0900)
              System clock synchronized: no
                NTP service: active
            RTC in local TZ: no

  ~$ date
  2021. 08. 14. (í† ) 01:02:27 KST
```  


> mysql  


```sql
mysql> select @@global.time_zone, @@session.time_zone,@@system_time_zone;
+--------------------+---------------------+--------------------+
| @@global.time_zone | @@session.time_zone | @@system_time_zone |
+--------------------+---------------------+--------------------+
| Asia/Seoul         | Asia/Seoul          | KST                |
+--------------------+---------------------+--------------------+
1 row in set (0.00 sec)
```

<br>  
<br>  

# 2. ë°ì´í„° ë² ì´ìŠ¤ ë¶„ì„ ì‹œìŠ¤í…œ  
by. ì„œí˜„, ê°€í¬  
<br>  
## 1. ë°ì´í„°ë² ì´ìŠ¤ ë¶„ì„ í…Œì´ë¸” ìƒì„± ë° ì´ë²¤íŠ¸ ìŠ¤ì¼€ì¤„ëŸ¬ ìƒì„±
![image](https://user-images.githubusercontent.com/61939286/128384676-d3e80d45-6cfb-465f-80f2-4be341b8c15e.png)  
<br>  

##   - ë°ì´í„°ë² ì´ìŠ¤ í…Œì´ë¸” ìƒì„±  

![image](https://user-images.githubusercontent.com/61939286/128417613-4b760909-5406-4395-9b16-b7ede5d8d91c.png)
![image](https://user-images.githubusercontent.com/61939286/128417645-1e90f932-fe2f-45f5-9fa7-4315f8971004.png)  


<details>
    <summary> Table ìƒì„± ì½”ë“œ </summary>  
  
 <div markdown="1">  
   
```sql
  # ì¼ ë³„ í…Œì´ë¸” ìƒì„±
  create table day_stats(
    _id INT PRIMARY KEY AUTO_INCREMENT,
      _date date,
      avg_people float,
      std_people float,
    avg_vehicle float,
      std_vehicle float
  );
   desc day_stats;

  # ì£¼ ë³„ í…Œì´ë¸” ìƒì„±
  create table week_stats(
    _id INT PRIMARY KEY AUTO_INCREMENT,
      start_date date,
      end_date date,
      avg_people float,
      std_people float,
    avg_vehicle float,
      std_vehicle float
  );

  # ì›” ë³„ í…Œì´ë¸” ìƒì„±
  create table month_stats(
    _id INT PRIMARY KEY AUTO_INCREMENT,
      start_date date, #ì›” í¬ë§·ì´ ì—†ì–´ì„œ ê·¸ëƒ¥ í•´ë‹¹ ë‹¬ì˜ ì²«ë‚ ë¡œí•¨
      avg_people float,
      std_people float,
    avg_vehicle float,
      std_vehicle float
  );
   
 # ì—°ë„ë³„ í…Œì´ë¸” ìƒì„±
  create table year_stats(
    _id INT PRIMARY KEY AUTO_INCREMENT,
      _year year, #ë…„ë„
      avg_people float,
      std_people float,
    avg_vehicle float,
      std_vehicle float
  );
  

  # ì›”ê°„ ìš”ì¼ë³„ í…Œì´ë¸” ìƒì„± (ì›”ìš”ì¼)
  create table monthly_mon_stats(
    _id INT PRIMARY KEY AUTO_INCREMENT,
      start_date date, #ì›” í¬ë§·ì´ ì—†ì–´ì„œ ê·¸ëƒ¥ í•´ë‹¹ ë‹¬ì˜ ì²«ë‚ ë¡œí•¨
      avg_people float,
      std_people float,
    avg_vehicle float,
      std_vehicle float
  );

  # ì›”ê°„ ìš”ì¼ë³„ í…Œì´ë¸” ìƒì„±(í™”ìš”ì¼)
  create table monthly_tue_stats(
    _id INT PRIMARY KEY AUTO_INCREMENT,
      start_date date, #ì›” í¬ë§·ì´ ì—†ì–´ì„œ ê·¸ëƒ¥ í•´ë‹¹ ë‹¬ì˜ ì²«ë‚ ë¡œí•¨
      avg_people float,
      std_people float,
    avg_vehicle float,
      std_vehicle float
  );

  # ì›”ê°„ ìš”ì¼ë³„ í…Œì´ë¸” ìƒì„±(ìˆ˜ìš”ì¼)
  create table monthly_wed_stats(
    _id INT PRIMARY KEY AUTO_INCREMENT,
      start_date date, #ì›” í¬ë§·ì´ ì—†ì–´ì„œ ê·¸ëƒ¥ í•´ë‹¹ ë‹¬ì˜ ì²«ë‚ ë¡œí•¨
      avg_people float,
      std_people float,
    avg_vehicle float,
      std_vehicle float
  );

  # ì›”ê°„ ìš”ì¼ë³„ í…Œì´ë¸” ìƒì„±(ëª©ìš”ì¼)
  create table monthly_thu_stats(
    _id INT PRIMARY KEY AUTO_INCREMENT,
      start_date date, #ì›” í¬ë§·ì´ ì—†ì–´ì„œ ê·¸ëƒ¥ í•´ë‹¹ ë‹¬ì˜ ì²«ë‚ ë¡œí•¨
      avg_people float,
      std_people float,
    avg_vehicle float,
      std_vehicle float
  );

  # ì›”ê°„ ìš”ì¼ë³„ í…Œì´ë¸” ìƒì„± (ê¸ˆìš”ì¼)
  create table monthly_fri_stats(
    _id INT PRIMARY KEY AUTO_INCREMENT,
      start_date date, #ì›” í¬ë§·ì´ ì—†ì–´ì„œ ê·¸ëƒ¥ í•´ë‹¹ ë‹¬ì˜ ì²«ë‚ ë¡œí•¨
      avg_people float,
      std_people float,
    avg_vehicle float,
      std_vehicle float
  );

  # ì›”ê°„ ìš”ì¼ë³„ í…Œì´ë¸” ìƒì„± (í† ìš”ì¼)
  create table monthly_sat_stats(
    _id INT PRIMARY KEY AUTO_INCREMENT,
      start_date date, #ì›” í¬ë§·ì´ ì—†ì–´ì„œ ê·¸ëƒ¥ í•´ë‹¹ ë‹¬ì˜ ì²«ë‚ ë¡œí•¨
      avg_people float,
      std_people float,
    avg_vehicle float,
      std_vehicle float
  );

  # ì›”ê°„ ìš”ì¼ë³„ í…Œì´ë¸” ìƒì„± (ì¼ìš”ì¼)
  create table monthly_sun_stats(
    _id INT PRIMARY KEY AUTO_INCREMENT,
      start_date date, #ì›” í¬ë§·ì´ ì—†ì–´ì„œ ê·¸ëƒ¥ í•´ë‹¹ ë‹¬ì˜ ì²«ë‚ ë¡œí•¨
      avg_people float,
      std_people float,
    avg_vehicle float,
      std_vehicle float
  );

  show tables;

  # ì—°ê°„ ìš”ì¼ë³„ í…Œì´ë¸” ìƒì„± (ì›”ìš”ì¼)
  create table yearly_mon_stats(
    _id INT PRIMARY KEY AUTO_INCREMENT,
      _year year, 
      avg_people float,
      std_people float,
    avg_vehicle float,
      std_vehicle float
  );

  # ì—°ê°„ ìš”ì¼ë³„ í…Œì´ë¸” ìƒì„± (í™”ìš”ì¼)
  create table yearly_tue_stats(
    _id INT PRIMARY KEY AUTO_INCREMENT,
      _year year, 
      avg_people float,
      std_people float,
    avg_vehicle float,
      std_vehicle float
  );
  # ì—°ê°„ ìš”ì¼ë³„ í…Œì´ë¸” ìƒì„± (ìˆ˜ìš”ì¼)
  create table yearly_wed_stats(
    _id INT PRIMARY KEY AUTO_INCREMENT,
      _year year, 
      avg_people float,
      std_people float,
    avg_vehicle float,
      std_vehicle float
  );
  # ì—°ê°„ ìš”ì¼ë³„ í…Œì´ë¸” ìƒì„± (ëª©ìš”ì¼)
  create table yearly_thu_stats(
    _id INT PRIMARY KEY AUTO_INCREMENT,
      _year year, 
      avg_people float,
      std_people float,
    avg_vehicle float,
      std_vehicle float
  );
  # ì—°ê°„ ìš”ì¼ë³„ í…Œì´ë¸” ìƒì„± (ê¸ˆìš”ì¼)
  create table yearly_fri_stats(
    _id INT PRIMARY KEY AUTO_INCREMENT,
      _year year, 
      avg_people float,
      std_people float,
    avg_vehicle float,
      std_vehicle float
  );
  # ì—°ê°„ ìš”ì¼ë³„ í…Œì´ë¸” ìƒì„± (í† ìš”ì¼)
  create table yearly_sat_stats(
    _id INT PRIMARY KEY AUTO_INCREMENT,
      _year year, 
      avg_people float,
      std_people float,
    avg_vehicle float,
      std_vehicle float
  );

  # ì—°ê°„ ìš”ì¼ë³„ í…Œì´ë¸” ìƒì„± (ì¼ìš”ì¼)
  create table yearly_sun_stats(
    _id INT PRIMARY KEY AUTO_INCREMENT,
      _year year, 
      avg_people float,
      std_people float,
    avg_vehicle float,
      std_vehicle float
  );
```
   
</div>  
  
</details>   

<br>  

##   - MySQl Event Scheduler  

> ğŸ’¢ **ì£¼ì˜**  
> CCTV ë°ì´í„°ëŠ” í˜„ì¬ ë¡œì»¬ ì‹œê°„ì— ëŒ€í•œ UTCì‹œê°„ìœ¼ë¡œ ì €ì¥ë  ê²ƒ  
> ë³¸ EventëŠ” UTCì‹œê°„ì„ ê¸°ì¤€ìœ¼ë¡œ ìŠ¤ì¼€ì¤„ëŸ¬ê°€ ì‘ë™ë¨  
> ë”°ë¼ì„œ ë°ì´í„° ì¡°íšŒ ì‹œ, ì‚¬ìš©ìë¡œë¶€í„° ì…ë ¥ë°›ì€ ë¡œì»¬ì‹œê°„ì„ UTCì‹œê°„ìœ¼ë¡œ ë³€í™˜í•˜ì—¬ ì¡°íšŒí•´ì•¼í•¨  
 <br>  


#### 1). ë§¤ì¼ 00:00:00 ì— í•˜ë£¨ì¹˜ ë°ì´í„° í‰ê· ê³¼ ê¸°ì¤€ê°’ì„ `day_stats` í…Œì´ë¸”ì— ì €ì¥  

```sql
CREATE EVENT `day_stats`
    ON SCHEDULE EVERY 1 Day 
    STARTS CURDATE() #ì˜¤ëŠ˜ë¶€í„° ì‹œì‘ (í‘œì¤€ì‹œê°„ ê¸°ì¤€ì„, í•œêµ­ì‹œê°„ì€ +9 hour í•´ì¤˜ì•¼ í•¨)
	ON COMPLETION NOT PRESERVE ENABLE
    COMMENT 'average and reference value of day'
    DO 
	INSERT INTO day_stats(_date, avg_people, std_people, avg_vehicle, std_vehicle) 
		SELECT  DATE_ADD(CURDATE(),INTERVAL -1 day)  , CONVERT(AVG(people), float), CONVERT(AVG(people)+1.5*STDDEV(people), float),
				CONVERT(AVG(vehicle), float), CONVERT(AVG(vehicle)+1.5*STDDEV(vehicle), float)
                FROM test  WHERE DATE(start_date) =  DATE_ADD(CURDATE(), INTERVAL -1 day) #ì–´ì œ ë°ì´í„°
```
<br>  

#### 2). ë§¤ì£¼ ì›”ìš”ì¼ì— `day_stats` tableì˜ ì¼ì£¼ì¼ ì¹˜(7ê°œì˜ row) í‰ê· ì„ `week_stats` í…Œì´ë¸”ì— ì €ì¥  

```sql
  CREATE EVENT `week_stats`
    ON SCHEDULE
	EVERY 1 WEEK
	STARTS CURRENT_DATE + INTERVAL 7- WEEKDAY(CURRENT_DATE) DAY #ê°€ì¥ ê°€ê¹Œìš´ ë¯¸ë˜ì˜ ì›”ìš”ì¼
	ON COMPLETION NOT PRESERVE ENABLE
    COMMENT 'average and reference value of week'
    DO 
	INSERT INTO week_stats(start_date, end_date, avg_people, std_people, avg_vehicle, std_vehicle) 
		SELECT CURRENT_DATE + INTERVAL -7- WEEKDAY(CURRENT_DATE) DAY,#ì§€ë‚œ ì£¼ ì›”ìš”ì¼
			CURRENT_DATE + INTERVAL -1 - WEEKDAY(CURRENT_DATE) DAY, #ì§€ë‚œ ì£¼ ì¼ìš”ì¼
			CONVERT(AVG(avg_people), float), CONVERT(AVG(std_people), float),
			CONVERT(AVG(avg_vehicle), float), CONVERT(AVG(std_vehicle), float)
			FROM day_stats WHERE _date BETWEEN DATE_ADD(NOW(),INTERVAL -1 WEEK ) AND NOW() #ì˜¤ëŠ˜(ë§¤ì£¼ ì›”ìš”ì¼ 0ì‹œ) ê¸°ì¤€ìœ¼ë¡œ ì§€ë‚œ ì¼ì£¼ì¼ ê°„
 ```
<br>  

#### 3). ë§¤ë‹¬ 1ì¼ì— `day_stats` tableì˜ í•œë‹¬ ì¹˜ í‰ê· ì„ `month_stats` í…Œì´ë¸”ì— ì €ì¥  

```sql
 CREATE EVENT `month_stats`
    ON SCHEDULE
	EVERY 1 MONTH
	STARTS LAST_DAY(NOW()) + interval 1 DAY #ê°€ì¥ ê°€ê¹Œìš´ 1ì¼ë¶€í„° ì‹œì‘
	ON COMPLETION NOT PRESERVE ENABLE
    COMMENT 'average and reference value of week'
    DO 
	INSERT INTO month_stats(start_date, avg_people, std_people, avg_vehicle, std_vehicle) 
		SELECT LAST_DAY(NOW() - interval 2 month) + interval 1 DAY, #ì§€ë‚œ ë‹¬ì˜ 1ì¼
			CONVERT(AVG(avg_people), float), CONVERT(AVG(std_people), float),
			CONVERT(AVG(avg_vehicle), float), CONVERT(AVG(std_vehicle), float)
			FROM day_stats WHERE _date BETWEEN DATE_ADD(NOW(),INTERVAL -1 WEEK ) AND NOW()
                            
```
<br>  


#### 4). ë§¤ë…„ 1ì›”1ì¼ì— `month_stats` tableì˜ ì¼ë…„ ì¹˜ í‰ê· (12ê°œì˜ row)ì„ `year_stats` í…Œì´ë¸”ì— ì €ì¥   

```sql
 CREATE EVENT `year_stats`
    ON SCHEDULE
	EVERY 1 YEAR
	STARTS LAST_DAY(DATE_ADD(NOW(), INTERVAL 12-MONTH(NOW()) MONTH))+ interval 1 DAY #ê°€ì¥ ê°€ê¹Œìš´ 1ì›” 1ì¼ë¶€í„° ì‹œì‘
	ON COMPLETION NOT PRESERVE ENABLE
    COMMENT 'average and reference value of year'
    DO 
	INSERT INTO year_stats(_year, avg_people, std_people, avg_vehicle, std_vehicle) 
		SELECT YEAR(CURDATE()-interval 1 DAY), # ì§€ë‚œ ë…„ë„
			CONVERT(AVG(avg_people), float), CONVERT(AVG(std_people), float),
			CONVERT(AVG(avg_vehicle), float), CONVERT(AVG(std_vehicle), float)
			FROM month_stats where start_date BETWEEN DATE_ADD(NOW(),INTERVAL -1 YEAR ) AND NOW() #ì§€ë‚œ ì¼ë…„
```


<br>  

<br>  

## 2. ì´ìƒê°’ íƒì§€ (MySQL Trigger)

![image](https://user-images.githubusercontent.com/61939286/128423327-e2084037-b1e3-4335-8211-5c0db99f467f.png)  
<br>  

```sql

DELIMITER //
CREATE TRIGGER detection 
	AFTER INSERT 
    ON test 
	FOR EACH ROW
BEGIN

# ê¸°ì¤€ ê°’ ì„¤ì •
	DECLARE people_ref_val, vehicle_ref_val FLOAT DEFAULT NULL;
    
	IF (SELECT COUNT(_id) FROM year_stats) >=1 THEN 	#ë…„ê°„ ë°ì´í„°ê°€ ìˆì„ ë•Œ
		SET people_ref_val = (SELECT AVG(std_people) FROM year_stats); #Në…„ì˜ í‰ê· ê°’ìœ¼ë¡œ í•¨
		SET vehicle_ref_val = (SELECT AVG(std_vehicle) FROM year_stats);
        
	ELSE IF (SELECT COUNT(_id) FROM month_stats) >=1 THEN
		SET people_ref_val = (SELECT AVG(std_people) FROM month_stats);
		SET vehicle_ref_val = (SELECT AVG(std_vehicle) FROM month_stats);
        
	ELSE IF (SELECT COUNT(_id) FROM week_stats) >=1 THEN
		SET people_ref_val = (SELECT AVG(std_people) FROM week_stats);
		SET vehicle_ref_val = (SELECT AVG(std_vehicle) FROM week_stats);
			
	ELSE IF (SELECT COUNT(_id) FROM day_stats) >=1 THEN
		SET people_ref_val = (SELECT AVG(std_people) FROM day_stats);
		SET vehicle_ref_val = (SELECT AVG(std_vehicle) FROM day_stats);
				END IF;
			END IF;
		END IF;
	END IF;

	# ì„¤ì •ëœ ê¸°ì¤€ ê°’ìœ¼ë¡œ ì´ìƒê°’ íƒì§€
    IF  NEW.people > (SELECT @people_ref_val) THEN
		IF  NEW.vehicle > (SELECT @vehicle_ref_val) THEN
			INSERT INTO backup VALUES(NEW.id, NEW.start_date ,NEW.end_date, NEW.people, NEW.vehicle, 'Outlier People & Vehicle');
		ELSE 
			INSERT INTO backup VALUES(NEW.id, NEW.start_date ,NEW.end_date, NEW.people, NEW.vehicle, 'Outlier People');
		END IF;
	ELSEIF NEW.vehicle > (SELECT @vehicle_ref_val) THEN
		INSERT INTO backup VALUES(NEW.id, NEW.start_date ,NEW.end_date, NEW.people, NEW.vehicle, 'Outlier Vehicle');
    END IF;
    
   
END //
DELIMITER ;
```
<br>  

## 3. ì‹¤ì œ ë°ì´í„° ì²˜ë¦¬ ë°©ë²•
![image](https://user-images.githubusercontent.com/61939286/128384838-1e2f4b61-4fdf-4c5d-a9fb-6af1aae0b97a.png)  

<br>  
<br>  


# 3. ì˜ìƒíŒ€ì—ì„œ í˜¸ì¶œí•  ìˆ˜ ìˆëŠ” API ìƒì„± -- ì‚¬ìš© X  
by. íƒœí›ˆ  
<br>  

![image](https://user-images.githubusercontent.com/61939286/128325508-30a0ed58-b215-4485-9e0c-17270f9f6be4.png)

ìˆ˜ë™ìœ¼ë¡œ ì…ë ¥ë°›ëŠ” í˜ì´ì§€ë¥¼ ë§Œë“¤ì—ˆìŠµë‹ˆë‹¤.  
tokenì„ í†µí•œ ë³´ì•ˆ ì¸ì¦ ì ˆì°¨ë¥¼ ì¶”ê°€í•˜ì˜€ìŠµë‹ˆë‹¤.  
<br>  


