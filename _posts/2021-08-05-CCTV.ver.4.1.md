---
layout: single
title:  "CCTV_ver_4.1. 영상팀에서 호출할 수 있는 API 제작, MySQL Event Scheduler로 데이터 분석"
author: seohyun-kim
date: 2021-08-05 18:00
comments: true
---


[![image](https://user-images.githubusercontent.com/61939286/125255176-2006fc80-e336-11eb-8f49-04f48e600742.png)](https://github.com/seohyun-kim/CCTV-Monitoring-System.git)  
➡ 위 이미지를 클릭하면 Repository로 이동합니다.  

<br>  

## 과제 목표  

> 리눅스 서버에 mysql설치   
> 데이터 베이스 분석 시스템  
> 영상팀에서 호출할 수 있는 API 생성(인증절차 추후 적용 예정)



<br>  

# 1. 리눅스 서버에 mysql설치 및 외부 접속허용
by. 서현  
> mysql 설치 완료 , DB생성  
> 사용자 계정 생성 및 DB권한 부여  
> 외부 접속 허용
 
```sql
mysql> show databases;
+--------------------+
| Database           |
+--------------------+
| cctv               |
| information_schema |
+--------------------+
2 rows in set (0.01 sec)

mysql> show grants;
+-------------------------------------------------+
| Grants for malab@%                              |
+-------------------------------------------------+
| GRANT USAGE ON *.* TO `malab`@`%`               |
| GRANT ALL PRIVILEGES ON `cctv`.* TO `malab`@`%` |
+-------------------------------------------------+
2 rows in set (0.01 sec)
```

<br>  
<br>  

# 2. 데이터 베이스 분석 시스템  
by. 서현, 가희  
<br>  
## 1. 데이터베이스 분석 테이블 생성 및 이벤트 스케줄러 생성
![image](https://user-images.githubusercontent.com/61939286/128384676-d3e80d45-6cfb-465f-80f2-4be341b8c15e.png)  
<br>  

### 데이터베이스 테이블 생성  

![image](https://user-images.githubusercontent.com/61939286/128391456-1c5616ef-a941-4276-ab9b-53af48dae0c4.png)

<details>
    <summary> Table 생성 코드 </summary>  
  
 <div markdown="1">  
   
```sql
  # 일 별 테이블 생성
  create table day_stats(
    _id INT PRIMARY KEY AUTO_INCREMENT,
      _date date,
      avg_people float,
      std_people float,
    avg_vehicle float,
      std_vehicle float
  );
   desc day_stats;

  # 주 별 테이블 생성
  create table week_stats(
    _id INT PRIMARY KEY AUTO_INCREMENT,
      start_date date,
      end_date date,
      avg_people float,
      std_people float,
    avg_vehicle float,
      std_vehicle float
  );

  # 월 별 테이블 생성
  create table month_stats(
    _id INT PRIMARY KEY AUTO_INCREMENT,
      start_date date, #월 포맷이 없어서 그냥 해당 달의 첫날로함
      avg_people float,
      std_people float,
    avg_vehicle float,
      std_vehicle float
  );

  # 월간 요일별 테이블 생성 (월요일)
  create table monthly_mon_stats(
    _id INT PRIMARY KEY AUTO_INCREMENT,
      start_date date, #월 포맷이 없어서 그냥 해당 달의 첫날로함
      avg_people float,
      std_people float,
    avg_vehicle float,
      std_vehicle float
  );

  # 월간 요일별 테이블 생성(화요일)
  create table monthly_tue_stats(
    _id INT PRIMARY KEY AUTO_INCREMENT,
      start_date date, #월 포맷이 없어서 그냥 해당 달의 첫날로함
      avg_people float,
      std_people float,
    avg_vehicle float,
      std_vehicle float
  );

  # 월간 요일별 테이블 생성(수요일)
  create table monthly_wed_stats(
    _id INT PRIMARY KEY AUTO_INCREMENT,
      start_date date, #월 포맷이 없어서 그냥 해당 달의 첫날로함
      avg_people float,
      std_people float,
    avg_vehicle float,
      std_vehicle float
  );

  # 월간 요일별 테이블 생성(목요일)
  create table monthly_thu_stats(
    _id INT PRIMARY KEY AUTO_INCREMENT,
      start_date date, #월 포맷이 없어서 그냥 해당 달의 첫날로함
      avg_people float,
      std_people float,
    avg_vehicle float,
      std_vehicle float
  );

  # 월간 요일별 테이블 생성 (금요일)
  create table monthly_fri_stats(
    _id INT PRIMARY KEY AUTO_INCREMENT,
      start_date date, #월 포맷이 없어서 그냥 해당 달의 첫날로함
      avg_people float,
      std_people float,
    avg_vehicle float,
      std_vehicle float
  );

  # 월간 요일별 테이블 생성 (토요일)
  create table monthly_sat_stats(
    _id INT PRIMARY KEY AUTO_INCREMENT,
      start_date date, #월 포맷이 없어서 그냥 해당 달의 첫날로함
      avg_people float,
      std_people float,
    avg_vehicle float,
      std_vehicle float
  );

  # 월간 요일별 테이블 생성 (일요일)
  create table monthly_sun_stats(
    _id INT PRIMARY KEY AUTO_INCREMENT,
      start_date date, #월 포맷이 없어서 그냥 해당 달의 첫날로함
      avg_people float,
      std_people float,
    avg_vehicle float,
      std_vehicle float
  );

  show tables;

  # 연간 요일별 테이블 생성 (월요일)
  create table yearly_mon_stats(
    _id INT PRIMARY KEY AUTO_INCREMENT,
      _year year, 
      avg_people float,
      std_people float,
    avg_vehicle float,
      std_vehicle float
  );

  # 연간 요일별 테이블 생성 (화요일)
  create table yearly_tue_stats(
    _id INT PRIMARY KEY AUTO_INCREMENT,
      _year year, 
      avg_people float,
      std_people float,
    avg_vehicle float,
      std_vehicle float
  );
  # 연간 요일별 테이블 생성 (수요일)
  create table yearly_wed_stats(
    _id INT PRIMARY KEY AUTO_INCREMENT,
      _year year, 
      avg_people float,
      std_people float,
    avg_vehicle float,
      std_vehicle float
  );
  # 연간 요일별 테이블 생성 (목요일)
  create table yearly_thu_stats(
    _id INT PRIMARY KEY AUTO_INCREMENT,
      _year year, 
      avg_people float,
      std_people float,
    avg_vehicle float,
      std_vehicle float
  );
  # 연간 요일별 테이블 생성 (금요일)
  create table yearly_fri_stats(
    _id INT PRIMARY KEY AUTO_INCREMENT,
      _year year, 
      avg_people float,
      std_people float,
    avg_vehicle float,
      std_vehicle float
  );
  # 연간 요일별 테이블 생성 (토요일)
  create table yearly_sat_stats(
    _id INT PRIMARY KEY AUTO_INCREMENT,
      _year year, 
      avg_people float,
      std_people float,
    avg_vehicle float,
      std_vehicle float
  );

  # 연간 요일별 테이블 생성 (일요일)
  create table yearly_sun_stats(
    _id INT PRIMARY KEY AUTO_INCREMENT,
      _year year, 
      avg_people float,
      std_people float,
    avg_vehicle float,
      std_vehicle float
  );
```
   
</div>  
  
</details>   

<br>  

### MySQl Event Scheduler



<br>  

## 2. 이상값 탐지  
![image](https://user-images.githubusercontent.com/61939286/128384781-ad0453e5-0126-4184-ab64-a2c71c9568da.png)  
<br>  

## 3. 실제 데이터 처리 방법
![image](https://user-images.githubusercontent.com/61939286/128384838-1e2f4b61-4fdf-4c5d-a9fb-6af1aae0b97a.png)
<br>  



# 3. 영상팀에서 호출할 수 있는 API 생성  
by. 태훈  
<br>  

![image](https://user-images.githubusercontent.com/61939286/128325508-30a0ed58-b215-4485-9e0c-17270f9f6be4.png)

일단 수동으로 입력받는 페이지를 만들었습니다.  
추후에 token을 사용하는 등의 보안절차를 추가할 예정입니다.  
<br>  

### 질문!  
*영상팀에서 데이터를 입력할 방법은 어떤식으로 하면 좋을 지 궁금합니다.  
파일첨부를 통해 입력을 받도록 해야할 지, 파이썬 코드로 원격 서버의 데이터베이스에 저장이 되도록 해야할 지 잘 모르겠습니다.*

